<!DOCTYPE html>
<html>
<head>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
  <div id="chart_sp500"></div>
  <div id="chart_sp_tsx"></div>
  <div id="chart_ibovespa"></div>
  <script>
    var sp_tsx_values = {
      // "05/1979": 1614.69, "06/1979": 1618.40,
      // "07/1979": 1558.09, "08/1979": 1695.30, "09/1979": 1751.90, "10/1979": 1580.00, "11/1979": 1699.59, "12/1979": 1813.19,
      // "01/1980": 2027.69, "02/1980": 2192.60, "03/1980": 1802.30, "04/1980": 1870.90, "05/1980": 1975.59, "06/1980": 2061.30,
      // "07/1980": 2200.50, "08/1980": 2218.19, "09/1980": 2267.39, "10/1980": 2247.10, "11/1980": 2405.69, "12/1980": 2270.80,
      // "01/1981": 2226.80, "02/1981": 2178.00, "03/1981": 2336.69, "04/1981": 2305.19, "05/1981": 2369.30, "06/1981": 2361.10,
      // "07/1981": 2253.89, "08/1981": 2179.19, "09/1981": 1880.69, "10/1981": 1856.30, "11/1981": 2013.19, "12/1981": 1952.19,
      "01/1982": 1773.50, "02/1982": 1670.00, "03/1982": 1584.80, "04/1982": 1546.59, "05/1982": 1511.90, "06/1982": 1366.80,
      "07/1982": 1411.90, "08/1982": 1614.09, "09/1982": 1596.09, "10/1982": 1772.59, "11/1982": 1846.19, "12/1982": 1958.09,
      "01/1983": 2034.80, "02/1983": 2110.10, "03/1983": 2156.89, "04/1983": 2342.50, "05/1983": 2402.80, "06/1983": 2447.00,
      "07/1983": 2477.60, "08/1983": 2488.00, "09/1983": 2479.60, "10/1983": 2369.80, "11/1983": 2538.50, "12/1983": 2551.89,
      "01/1984": 2473.19, "02/1984": 2419.00, "03/1984": 2382.80, "04/1984": 2325.00, "05/1984": 2238.80, "06/1984": 2220.89,
      "07/1984": 2147.39, "08/1984": 2391.80, "09/1984": 2385.60, "10/1984": 2352.39, "11/1984": 2364.89, "12/1984": 2398.39,
      "01/1985": 2584.00, "02/1985": 2601.39, "03/1985": 2614.30, "04/1985": 2637.19, "05/1985": 2744.39, "06/1985": 2712.50,
      "07/1985": 2782.00, "08/1985": 2814.39, "09/1985": 2631.30, "10/1985": 2677.39, "11/1985": 2854.89, "12/1985": 2898.19,
      "01/1986": 2840.69, "02/1986": 2854.80, "03/1986": 3045.69, "04/1986": 3062.30, "05/1986": 3120.00, "06/1986": 3085.50,
      "07/1986": 2936.69, "08/1986": 3035.89, "09/1986": 2983.00, "10/1986": 3042.50, "11/1986": 3046.30, "12/1986": 3064.00,
      "01/1987": 3350.50, "02/1987": 3506.80, "03/1987": 3725.10, "04/1987": 3718.60, "05/1987": 3681.80, "06/1987": 3740.19,
      "07/1987": 4030.39, "08/1987": 4003.00, "09/1987": 3901.19, "10/1987": 3023.50, "11/1987": 2992.10, "12/1987": 3168.39,
      "01/1988": 3065.00, "02/1988": 3213.50, "03/1988": 3313.39, "04/1988": 3335.39, "05/1988": 3271.39, "06/1988": 3441.50,
      "07/1988": 3376.69, "08/1988": 3269.60, "09/1988": 3277.80, "10/1988": 3387.89, "11/1988": 3297.69, "12/1988": 3377.60,
      "01/1989": 3611.80, "02/1989": 3577.00, "03/1989": 3574.19, "04/1989": 3606.10, "05/1989": 3702.80, "06/1989": 3760.89,
      "07/1989": 3982.69, "08/1989": 4011.39, "09/1989": 3944.00, "10/1989": 3917.89, "11/1989": 3950.30, "12/1989": 3962.19,
      "01/1990": 3714.00, "02/1990": 3682.50, "03/1990": 3599.39, "04/1990": 3349.10, "05/1990": 3607.00, "06/1990": 3543.89,
      "07/1990": 3560.60, "08/1990": 3327.10, "09/1990": 3169.69, "10/1990": 3074.19, "11/1990": 3161.19, "12/1990": 3246.10,
      "01/1991": 3271.80, "02/1991": 3445.50, "03/1991": 3491.30, "04/1991": 3471.60, "05/1991": 3540.80, "06/1991": 3465.80,
      "07/1991": 3536.10, "08/1991": 3512.80, "09/1991": 3393.89, "10/1991": 3520.10, "11/1991": 3430.39, "12/1991": 3493.00,
      "01/1992": 3589.60, "02/1992": 3573.50, "03/1992": 3393.30, "04/1992": 3364.39, "05/1992": 3377.89, "06/1992": 3387.69,
      "07/1992": 3443.39, "08/1992": 3399.10, "09/1992": 3304.80, "10/1992": 3335.00, "11/1992": 3278.80, "12/1992": 3349.00,
      "01/1993": 3308.39, "02/1993": 3447.80, "03/1993": 3598.60, "04/1993": 3787.60, "05/1993": 3875.50, "06/1993": 3966.39,
      "07/1993": 3967.19, "08/1993": 4124.00, "09/1993": 3985.00, "10/1993": 4228.29, "11/1993": 4195.70, "12/1993": 4321.39,
      "01/1994": 4574.79, "02/1994": 4408.79, "03/1994": 4250.70, "04/1994": 4275.60, "05/1994": 4314.79, "06/1994": 4025.30,
      "07/1994": 4179.00, "08/1994": 4335.39, "09/1994": 4352.60, "10/1994": 4278.20, "11/1994": 4096.20, "12/1994": 4192.89,
      "01/1995": 4039.00, "02/1995": 4113.89, "03/1995": 4305.29, "04/1995": 4276.29, "05/1995": 4448.70, "06/1995": 4527.20,
      "07/1995": 4604.89, "08/1995": 4510.79, "09/1995": 4513.29, "10/1995": 4449.10, "11/1995": 4658.00, "12/1995": 4707.39,
      "01/1996": 4983.39, "02/1996": 4947.20, "03/1996": 4970.20, "04/1996": 5142.70, "05/1996": 5234.60, "06/1996": 5044.10,
      "07/1996": 4933.20, "08/1996": 5120.00, "09/1996": 5296.29, "10/1996": 5606.00, "11/1996": 5978.89, "12/1996": 5917.79,
      "01/1997": 6123.20, "02/1997": 6125.00, "03/1997": 5840.29, "04/1997": 5973.29, "05/1997": 6403.39, "06/1997": 6437.70,
      "07/1997": 6877.29, "08/1997": 6618.29, "09/1997": 7070.70, "10/1997": 6919.60, "11/1997": 6537.89, "12/1997": 6708.89,
      "01/1998": 6769.39, "02/1998": 7106.89, "03/1998": 7549.70, "04/1998": 7706.10, "05/1998": 7558.89, "06/1998": 7366.89,
      "07/1998": 6931.39, "08/1998": 5566.39, "09/1998": 5533.50, "10/1998": 6279.20, "11/1998": 6316.50, "12/1998": 6522.20,
      "01/1999": 6754.79, "02/1999": 6289.60, "03/1999": 6613.10, "04/1999": 7020.10, "05/1999": 6841.79, "06/1999": 7010.10,
      "07/1999": 7081.00, "08/1999": 6993.00, "09/1999": 6906.39, "10/1999": 7227.10, "11/1999": 7691.39, "12/1999": 8413.79,
      "01/2000": 8496.29, "02/2000": 9317.90, "03/2000": 9520.70, "04/2000": 9399.09, "05/2000": 9397.90, "06/2000": 10195.50,
      "07/2000": 10456.70, "08/2000": 11375.40, "09/2000": 10491.70, "10/2000": 9561.29, "11/2000": 8896.79, "12/2000": 8961.79,
      "01/2001": 9276.40, "02/2001": 8033.10, "03/2001": 7633.29, "04/2001": 7915.60, "05/2001": 8180.10, "06/2001": 7736.39,
      "07/2001": 7703.00, "08/2001": 7420.29, "09/2001": 6801.89, "10/2001": 6904.60, "11/2001": 7366.00, "12/2001": 7679.60,
      "01/2002": 7641.10, "02/2002": 7672.89, "03/2002": 7854.00, "04/2002": 7646.60, "05/2002": 7631.39, "06/2002": 7145.60,
      "07/2002": 6573.10, "08/2002": 6565.70, "09/2002": 6177.89, "10/2002": 6247.79, "11/2002": 6652.00, "12/2002": 6632.29,
      "01/2003": 6591.29, "02/2003": 6570.50, "03/2003": 6351.20, "04/2003": 6584.10, "05/2003": 6885.79, "06/2003": 6983.10,
      "07/2003": 7226.50, "08/2003": 7507.70, "09/2003": 7433.10, "10/2003": 7799.00, "11/2003": 7896.50, "12/2003": 8241.20,
      "01/2004": 8546.90, "02/2004": 8840.59, "03/2004": 8632.09, "04/2004": 8283.79, "05/2004": 8390.20, "06/2004": 8545.59,
      "07/2004": 8458.09, "08/2004": 8356.09, "09/2004": 8665.09, "10/2004": 8877.70, "11/2004": 9037.79, "12/2004": 9246.70,
      "01/2005": 9211.50, "02/2005": 9701.20, "03/2005": 9675.29, "04/2005": 9349.09, "05/2005": 9618.40, "06/2005": 9902.79,
      "07/2005": 10422.90, "08/2005": 10675.59, "09/2005": 11035.00, "10/2005": 10390.00, "11/2005": 10868.20, "12/2005": 11304.59,
      "01/2006": 11962.79, "02/2006": 11694.70, "03/2006": 12200.70, "04/2006": 12289.20, "05/2006": 11695.00, "06/2006": 11612.90,
      "07/2006": 11864.09, "08/2006": 12121.59, "09/2006": 11767.40, "10/2006": 12023.29, "11/2006": 12757.40, "12/2006": 12924.50,
      "01/2007": 13090.70, "02/2007": 12920.00, "03/2007": 13185.29, "04/2007": 13430.20, "05/2007": 14084.50, "06/2007": 13906.59,
      "07/2007": 13751.79, "08/2007": 13673.70, "09/2007": 14113.09, "10/2007": 14485.70, "11/2007": 13671.59, "12/2007": 13907.70,
      "01/2008": 13202.59, "02/2008": 13622.50, "03/2008": 13337.70, "04/2008": 13920.29, "05/2008": 14673.90, "06/2008": 14467.00,
      "07/2008": 13645.09, "08/2008": 13558.79, "09/2008": 11730.70, "10/2008": 9841.29, "11/2008": 8816.40, "12/2008": 8951.90,
      "01/2009": 8603.00, "02/2009": 7997.60, "03/2009": 8647.59, "04/2009": 9369.20, "05/2009": 10530.79, "06/2009": 10374.90,
      "07/2009": 10787.20, "08/2009": 10840.90, "09/2009": 11403.29, "10/2009": 10896.70, "11/2009": 11574.70, "12/2009": 11847.29,
      "01/2010": 11147.50, "02/2010": 11682.79, "03/2010": 12069.90, "04/2010": 12274.00, "05/2010": 11702.20, "06/2010": 11294.40,
      "07/2010": 11713.40, "08/2010": 11978.29, "09/2010": 12400.09, "10/2010": 12725.90, "11/2010": 13067.00, "12/2010": 13443.20,
      "01/2011": 13617.70, "02/2011": 14167.00, "03/2011": 14118.20, "04/2011": 13944.79, "05/2011": 13806.09, "06/2011": 13300.90,
      "07/2011": 12945.59, "08/2011": 12770.70, "09/2011": 11516.90, "10/2011": 11963.20, "11/2011": 12174.09, "12/2011": 12097.20,
      "01/2012": 12510.70, "02/2012": 12643.00, "03/2012": 12381.50, "04/2012": 12325.70, "05/2012": 11413.09, "06/2012": 11596.59,
      "07/2012": 11693.09, "08/2012": 11978.00, "09/2012": 12372.50, "10/2012": 12408.50, "11/2012": 12253.70, "12/2012": 12571.79,
      "01/2013": 12741.20, "02/2013": 12798.70, "03/2013": 12751.59, "04/2013": 12408.00, "05/2013": 12661.20, "06/2013": 12178.00,
      "07/2013": 12486.59, "08/2013": 12654.29, "09/2013": 12787.20, "10/2013": 13362.90, "11/2013": 13395.40, "12/2013": 13621.40,
      "01/2014": 13694.90, "02/2014": 14209.70, "03/2014": 14335.29, "04/2014": 14651.90, "05/2014": 14604.20, "06/2014": 15146.00,
      "07/2014": 15330.79, "08/2014": 15626.90, "09/2014": 14958.50, "10/2014": 14632.20, "11/2014": 14753.50, "12/2014": 14637.29,
      "01/2015": 14713.90, "02/2015": 15240.90, "03/2015": 14925.20, "04/2015": 15224.40, "05/2015": 15040.90, "06/2015": 14588.20,
      "07/2015": 14465.79, "08/2015": 13691.79, "09/2015": 13362.50, "10/2015": 13531.00, "11/2015": 13488.40, "12/2015": 12920.59,
      "01/2016": 12766.20, "02/2016": 12896.29, "03/2016": 13404.59, "04/2016": 13963.90, "05/2016": 14017.00, "06/2016": 14200.09,
      "07/2016": 14555.20, "08/2016": 14573.29, "09/2016": 14722.50, "10/2016": 14827.90, "11/2016": 15138.59, "12/2016": 15366.79,
      "01/2017": 15423.79, "02/2017": 15534.70, "03/2017": 15587.00, "04/2017": 15601.70, "05/2017": 15363.09, "06/2017": 15217.40,
      "07/2017": 15192.09, "08/2017": 15194.70, "09/2017": 15640.00, "10/2017": 16093.40, "11/2017": 16058.20, "12/2017": 16213.40,
      "01/2018": 15920.00, "02/2018": 15442.68, "03/2018": 15367.29, "04/2018": 15607.88, "05/2018": 16061.50, "06/2018": 16277.73,
      "07/2018": 16434.01, "08/2018": 16262.88, "09/2018": 16073.14, "10/2018": 14843.12, "11/2018": 15197.82, "12/2018": 14322.86,
      "01/2019": 15540.60, "02/2019": 15999.01, "03/2019": 16102.09, "04/2019": 16580.73, "05/2019": 16037.49, "06/2019": 16382.20,
      "07/2019": 16406.56, "08/2019": 16442.07, "09/2019": 16658.63, "10/2019": 16483.16, "11/2019": 17040.20, "12/2019": 17063.43,
      "01/2020": 17318.49, "02/2020": 16263.05
    }

    var gdp_canada_trillions = {
      1981: 0.381,
      1982: 0.392,
      1983: 0.435,
      1984: 0.471,
      1985: 0.511,
      1986: 0.529,
      1987: 0.591,
      1988: 0.640,
      1989: 0.677,
      1990: 0.692,
      1991: 0.702,
      1992: 0.721,
      1993: 0.753,
      1994: 0.806,
      1995: 0.835,
      1996: 0.874,
      1997: 0.919,
      1998: 0.950,
      1999: 1.035,
      2000: 1.126,
      2001: 1.127,
      2002: 1.214,
      2003: 1.262,
      2004: 1.341,
      2005: 1.458,
      2006: 1.503,
      2007: 1.596,
      2008: 1.609,
      2009: 1.608,
      2010: 1.698,
      2011: 1.809,
      2012: 1.840,
      2013: 1.928,
      2014: 2.009,
      2015: 2.000,
      2016: 2.079,
      2017: 2.180,
      2018: 2.223,
      2019: 2.338,
    };

    var ibovespa_values = {
      "01/1995": 4319.07, "02/1995": 3989.82, "03/1995": 2989.08, "04/1995": 2893.52, "05/1995": 3861.51, "06/1995": 3773.55,
      "07/1995": 3594.37, "08/1995": 3870.80, "09/1995": 4449.98, "10/1995": 4538.00, "11/1995": 4099.82, "12/1995": 4345.99,
      "01/1996": 4390.05, "02/1996": 5269.38, "03/1996": 5083.35, "04/1996": 5009.27, "05/1996": 5146.00, "06/1996": 5635.07,
      "07/1996": 6156.19, "08/1996": 6277.30, "09/1996": 6232.54, "10/1996": 6521.77, "11/1996": 6641.18, "12/1996": 6735.63,
      "01/1997": 6955.54, "02/1997": 8095.94, "03/1997": 8978.20, "04/1997": 9138.30, "05/1997": 10074.20, "06/1997": 11360.80,
      "07/1997": 13002.20, "08/1997": 12259.10, "09/1997": 10109.10, "10/1997": 12173.40, "11/1997": 9858.00, "12/1997": 9648.40,
      "01/1998": 10479.85, "02/1998": 9973.05, "03/1998": 10845.34, "04/1998": 11836.93, "05/1998": 11507.43, "06/1998": 9605.44,
      "07/1998": 9914.51, "08/1998": 10412.99, "09/1998": 6917.09, "10/1998": 5960.46, "11/1998": 7509.06, "12/1998": 8544.56,
      "01/1999": 6941.99, "02/1999": 8891.03, "03/1999": 9198.00, "04/1999": 11021.53, "05/1999": 11436.90, "06/1999": 11050.65,
      "07/1999": 11708.12, "08/1999": 10211.04, "09/1999": 10902.34, "10/1999": 10959.83, "11/1999": 11762.60, "12/1999": 13874.31,
      "01/2000": 16930.42, "02/2000": 16522.20, "03/2000": 17953.01, "04/2000": 17245.47, "05/2000": 15524.13, "06/2000": 15450.04,
      "07/2000": 17088.54, "08/2000": 16289.87, "09/2000": 17577.42, "10/2000": 15559.30, "11/2000": 14791.19, "12/2000": 13437.49,
      "01/2001": 15425.34, "02/2001": 17038.74, "03/2001": 16416.58, "04/2001": 13981.30, "05/2001": 14897.24, "06/2001": 14791.97,
      "07/2001": 14555.00, "08/2001": 13743.06, "09/2001": 12800.03, "10/2001": 10501.12, "11/2001": 11387.81, "12/2001": 13336.00,
      "01/2002": 13872.00, "02/2002": 12658.60, "03/2002": 14414.80, "04/2002": 13467.30, "05/2002": 12538.20, "06/2002": 12659.40,
      "07/2002": 10892.40, "08/2002": 9759.60, "09/2002": 10378.40, "10/2002": 8997.50, "11/2002": 10140.00, "12/2002": 10673.70,
      "01/2003": 11602.90, "02/2003": 10910.00, "03/2003": 10305.50, "04/2003": 11592.10, "05/2003": 12810.00, "06/2003": 13228.70,
      "07/2003": 13291.10, "08/2003": 13129.80, "09/2003": 15352.10, "10/2003": 16578.74, "11/2003": 18517.10, "12/2003": 20520.60,
      "01/2004": 22444.71, "02/2004": 21786.90, "03/2004": 22498.50, "04/2004": 22647.07, "05/2004": 19708.50, "06/2004": 19545.80,
      "07/2004": 21348.67, "08/2004": 22448.01, "09/2004": 22512.80, "10/2004": 23777.02, "11/2004": 23272.98, "12/2004": 25234.70,
      "01/2005": 25722.01, "02/2005": 24149.46, "03/2005": 27729.98, "04/2005": 26773.83, "05/2005": 24704.60, "06/2005": 25948.83,
      "07/2005": 25311.44, "08/2005": 26298.07, "09/2005": 27962.19, "10/2005": 31856.13, "11/2005": 30899.71, "12/2005": 32617.18,
      "01/2006": 33507.27, "02/2006": 38484.84, "03/2006": 39177.87, "04/2006": 38717.07, "05/2006": 41016.58, "06/2006": 37748.30,
      "07/2006": 37357.20, "08/2006": 36839.31, "09/2006": 37329.15, "10/2006": 37057.75, "11/2006": 39930.05, "12/2006": 41327.07,
      "01/2007": 45382.61, "02/2007": 44815.01, "03/2007": 43516.91, "04/2007": 45597.48, "05/2007": 49471.54, "06/2007": 53422.67,
      "07/2007": 55371.21, "08/2007": 54233.87, "09/2007": 54832.51, "10/2007": 62340.34, "11/2007": 64050.08, "12/2007": 63199.85,
      "01/2008": 62815.13, "02/2008": 61079.83, "03/2008": 64490.46, "04/2008": 62774.85, "05/2008": 69366.39, "06/2008": 71897.25,
      "07/2008": 63396.19, "08/2008": 57630.35, "09/2008": 55162.14, "10/2008": 49798.65, "11/2008": 38249.44, "12/2008": 34740.50,
      "01/2009": 40244.22, "02/2009": 38666.44, "03/2009": 36234.69, "04/2009": 41976.33, "05/2009": 50404.53, "06/2009": 54486.29,
      "07/2009": 51543.78, "08/2009": 55997.81, "09/2009": 55814.96, "10/2009": 60459.33, "11/2009": 62643.23, "12/2009": 68408.40,
      "01/2010": 70045.08, "02/2010": 66571.74, "03/2010": 67227.93, "04/2010": 71136.34, "05/2010": 67119.41, "06/2010": 61840.99,
      "07/2010": 61236.20, "08/2010": 68517.46, "09/2010": 67072.53, "10/2010": 70229.35, "11/2010": 71560.93, "12/2010": 69345.85,
      "01/2011": 69962.32, "02/2011": 67847.34, "03/2011": 66242.63, "04/2011": 69268.29, "05/2011": 65462.75, "06/2011": 63411.48,
      "07/2011": 63394.34, "08/2011": 58535.74, "09/2011": 58118.20, "10/2011": 50791.53, "11/2011": 57322.75, "12/2011": 58143.42,
      "01/2012": 57829.27, "02/2012": 64567.18, "03/2012": 66809.80, "04/2012": 65216.25, "05/2012": 62423.56, "06/2012": 53402.90,
      "07/2012": 54692.79, "08/2012": 56291.93, "09/2012": 57281.45, "10/2012": 59570.80, "11/2012": 58382.68, "12/2012": 58202.35,
      "01/2013": 62550.10, "02/2013": 60351.16, "03/2013": 56883.99, "04/2013": 55902.18, "05/2013": 55321.93, "06/2013": 53944.36,
      "07/2013": 47229.59, "08/2013": 49140.78, "09/2013": 51835.15, "10/2013": 53179.46, "11/2013": 54013.24, "12/2013": 51244.87,
      "01/2014": 50341.25, "02/2014": 46147.52, "03/2014": 46589.00, "04/2014": 50270.37, "05/2014": 52980.31, "06/2014": 51605.83,
      "07/2014": 53171.49, "08/2014": 55902.87, "09/2014": 61141.27, "10/2014": 52858.43, "11/2014": 53947.21, "12/2014": 52276.58,
      "01/2015": 48512.22, "02/2015": 47650.73, "03/2015": 51020.81, "04/2015": 52321.76, "05/2015": 57353.98, "06/2015": 53031.31,
      "07/2015": 52757.53, "08/2015": 50138.04, "09/2015": 45477.06, "10/2015": 45313.27, "11/2015": 48053.66, "12/2015": 45046.75,
      "01/2016": 40570.03, "02/2016": 44121.79, "03/2016": 50561.52, "04/2016": 53561.53, "05/2016": 49012.65, "06/2016": 52233.04,
      "07/2016": 56755.76, "08/2016": 58236.26, "09/2016": 59461.22, "10/2016": 63326.41, "11/2016": 59506.54, "12/2016": 60227.29,
      "01/2017": 59588.70, "02/2017": 64836.12, "03/2017": 66988.87, "04/2017": 65211.47, "05/2017": 66721.74, "06/2017": 62288.52,
      "07/2017": 63279.58, "08/2017": 66516.23, "09/2017": 71923.11, "10/2017": 74308.49, "11/2017": 71783.35, "12/2017": 76402.08,
      "01/2018": 84912.69, "02/2018": 85353.60, "03/2018": 85365.56, "04/2018": 86115.50, "05/2018": 76753.61, "06/2018": 72762.51,
      "07/2018": 79220.43, "08/2018": 76677.53, "09/2018": 79342.42, "10/2018": 84691.31
    };

    var gdp_brazil_billions = {
      1994: 356.801,
      1995: 720.985,
      1996: 854.763,
      1997: 952.089,
      1998: 1002.351,
      1999: 1087.711,
      2000: 1199.093,
      2001: 1315.756,
      2002: 1488.788,
      2003: 1717.951,
      2004: 1957.750,
      2005: 2170.584,
      2006: 2409.450,
      2007: 2720.263,
      2008: 3109.803,
      2009: 3333.039,
      2010: 3885.847,
      2011: 4376.382,
      2012: 4814.760,
      2013: 5331.619,
      2014: 5778.952,
      2015: 6000.572,
      2016: 6266.895,
      2017: 6558.194
    };

    function gdpAverageLastYears(gdp, year, howManyYears) {
      var values = []
      for (var y = year; y > year - howManyYears; y--) {
        if (y in gdp) {
          values.push(gdp[y]);
        }
      }
      return values.reduce(function(a, b) {return a+b;}) / values.length;
    }

    function plotRatioChart(gdp, index, name, chartDiv) {
      var months = [];
      var values = [];
      var normalizedValues = [];

      var ratioValues = [];
      for (var key in index) {
          var year = key.split("/")[1] - 1;
          ratioValues.push(index[key] / gdpAverageLastYears(gdp, year, 5));
      }
      var avgValuation = ratioValues.reduce(function(a, b) {return a+b;}) / ratioValues.length;

      for (var key in index) {
          months.push(key);
          values.push(index[key]);
          var year = key.split("/")[1] - 1;
          var valuation = index[key] / gdpAverageLastYears(gdp, year, 5);
          var overvaluation = valuation / avgValuation;
          normalizedValues.push(index[key] / overvaluation);
      }

      Plotly.plot(chartDiv, [
        {
          x: months,
          y: values,
          margin: {t: 0},
          name: name
        },
        {
          x: months,
          y: normalizedValues,
          margin: {t: 0},
          name: name + " (normalized)",
          line: {dash: 'dot'}
        },
        {
          x: months,
          y: normalizedValues.map(function(v) {return v*0.9}),
          margin: {t: 0},
          name: name + " (normalized, 10% discount)",
          line: {dash: 'dot', width: 1}
        },
        {
          x: months,
          y: normalizedValues.map(function(v) {return v*1.1}),
          margin: {t: 0},
          name: name + " (normalized, 10% premium)",
          line: {dash: 'dot', width: 1}
        }
      ], {yaxis: {type : 'log'}});
    }

    function simulatedGrowthMultipleScenarios(gdp, index, avgInflation, name) {
      var results = [];
      for (var t = 0.8; t <= 1.6; t += 0.05) {
        for (var bf = 1; bf <= 10; bf += 1) {
          results.push(simulatedGrowth(gdp, index, avgInflation, name, t, bf));
        }
      }
      results.sort(function(x,y) {return y['totalGrowth'] - x['totalGrowth']});
      var bestResult = results[0];
      console.log(name + " - best result: " + JSON.stringify(bestResult, null, 2));
    }

    plotRatioChart(gdp_canada_trillions, sp_tsx_values, "S&P TSX", "chart_sp_tsx");
    plotRatioChart(gdp_brazil_billions, ibovespa_values, "Ibovespa", "chart_ibovespa");
  </script>
</body>
</html>
